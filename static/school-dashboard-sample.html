<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>American High School - Admin Analytics</title>
    <meta property="og:title" content="American High School Admin Dashboard (Demo)">
    <meta property="og:description" content="A demonstration of education analytics tracking student failure rates and interventions.">
    <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=Admin+Analytics+Dashboard"> 
    
    <style>
        :root {
            --primary: #0F52BA; /* Classic School Blue */
            --primary-dark: #0a3d8f;
            --secondary: #6c757d;
            --success-bg: #d4edda;
            --success-text: #155724;
            --danger-bg: #f8d7da;
            --danger-text: #721c24;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --light-bg: #f4f6f9;
            --card-bg: #ffffff;
            --border: #e0e0e0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 0;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        header {
            background-color: var(--card-bg);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand h1 { margin: 0; font-size: 1.5rem; color: var(--primary); }
        .brand h2 { margin: 0; font-size: 0.9rem; color: var(--secondary); font-weight: 400; margin-top: 4px; }
        
        .header-right { text-align: right; }
        .date-display { font-size: 0.9rem; font-weight: 600; color: #333; }
        .refresh-note { font-size: 0.75rem; color: var(--secondary); }

        /* --- Disclaimer Banner --- */
        .disclaimer-banner {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            text-align: center;
            padding: 12px;
            font-size: 0.85rem;
            border-bottom: 1px solid #ffeeba;
            font-weight: 600;
            line-height: 1.4;
        }

        /* --- Layout --- */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 1.5rem;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
        }

        /* --- KPI Section --- */
        .kpi-section {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem 4rem;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 5px solid var(--danger-text);
            width: 100%;
            max-width: 600px;
        }

        .kpi-title { font-size: 1.1rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .kpi-value { font-size: 4rem; font-weight: 800; color: var(--danger-text); margin: 5px 0; }
        .kpi-sub { font-size: 1.1rem; color: var(--secondary); }

        /* --- Main Stats Table --- */
        .stats-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 1.5rem; 
            border-bottom: 2px solid var(--light-bg);
            padding-bottom: 1rem;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .section-title { margin: 0; color: var(--primary); font-size: 1.4rem; }
        .legend { font-size: 0.85rem; color: var(--secondary); }
        .legend span { display: inline-block; width: 12px; height: 12px; border-radius: 2px; margin-left: 10px; margin-right: 4px; vertical-align: middle; }
        .legend .bad { background-color: var(--danger-bg); border: 1px solid var(--danger-text); }
        .legend .good { background-color: var(--success-bg); border: 1px solid var(--success-text); }

        /* Mobile Responsive Table Wrapper */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            width: 100%;
        }

        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 600px; }
        
        th { 
            padding: 15px; 
            text-align: center; 
            background-color: #f8f9fa; 
            color: var(--secondary); 
            font-size: 0.85rem; 
            text-transform: uppercase; 
            font-weight: 700;
            border-bottom: 2px solid var(--border);
        }
        th:first-child { text-align: left; position: sticky; left: 0; background-color: #f8f9fa; z-index: 10; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }

        td { 
            padding: 12px 15px; 
            text-align: center; 
            border-bottom: 1px solid var(--border); 
            font-size: 0.95rem;
        }
        
        td:first-child { 
            text-align: left; 
            font-weight: 600; 
            color: #2c3e50; 
            width: 30%;
            position: sticky;
            left: 0;
            background-color: white; 
            z-index: 10;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        /* --- Row Coloring --- */
        tr.row-bad { background-color: #fff5f5; } 
        tr.row-good { background-color: #f0fff4; } 
        /* Fix sticky background color for colored rows */
        tr.row-bad td:first-child { background-color: #fff5f5; }
        tr.row-good td:first-child { background-color: #f0fff4; }

        tr:hover { background-color: #eef2ff !important; transition: background-color 0.2s; }
        tr:hover td:first-child { background-color: #eef2ff !important; }

        .clickable-cell {
            cursor: pointer;
            color: var(--primary);
            font-weight: 700;
            text-decoration: underline;
            text-decoration-color: rgba(15, 82, 186, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            transition: all 0.2s;
            display: inline-block; 
        }
        .clickable-cell:hover {
            background-color: rgba(15, 82, 186, 0.1);
            text-decoration-color: var(--primary);
        }
        .non-clickable-cell { color: #555; font-weight: 400; }

        /* --- Top 10 Grids & Tabs --- */
        .top-ten-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .top-list {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow-x: hidden;
        }

        .top-list-header {
            border-bottom: 2px solid var(--border);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .top-list h4 { 
            margin: 0 0 10px 0; 
            color: var(--secondary); 
            text-transform: uppercase; 
            font-size: 0.9rem; 
        }

        /* Tab Styling */
        .list-tabs {
            display: flex;
            gap: 10px;
        }

        .list-tab {
            background: none;
            border: none;
            padding: 5px 10px;
            font-size: 0.85rem;
            cursor: pointer;
            color: var(--secondary);
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .list-tab:hover { color: var(--primary); }

        .list-tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .mini-table { min-width: 100%; }
        .mini-table th { background: white; border-bottom: 1px solid var(--primary); color: var(--primary); padding: 8px; font-size: 0.8rem; }
        .mini-table td { padding: 8px; font-size: 0.9rem; border-bottom: 1px solid #eee; }
        .rank-col { width: 30px; color: var(--secondary); font-weight: bold; }
        .val-col { font-weight: bold; color: var(--danger-text); }
        .rate-col { font-weight: bold; color: #d35400; }

        /* --- Footer --- */
        footer {
            background-color: white;
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            margin-top: auto;
        }
        
        .footer-content p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: var(--secondary);
        }

        .footer-link {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s;
        }
        
        .footer-link:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }

        /* --- Modal Styling --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(2px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-sizing: border-box;
        }

        .modal-content {
            background: white;
            width: 700px;
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header {
            padding: 15px 20px;
            background-color: var(--primary);
            color: white;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 { margin: 0; font-size: 1.1rem; }
        .modal-close { background: none; border: none; color: white; font-size: 1.8rem; cursor: pointer; padding: 0 10px;}

        .modal-subheader {
            padding: 10px 20px;
            background-color: #f1f3f5;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .modal-stats-line { font-size: 0.9rem; color: #333; font-weight: 600; }
        .modal-desc-line { font-size: 0.8rem; color: #666; font-style: italic; }

        .modal-body {
            padding: 0;
            overflow-y: auto;
            flex: 1;
            -webkit-overflow-scrolling: touch;
        }

        .student-row {
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.1s;
        }
        
        .student-info { display: flex; flex-direction: column; }
        .student-name { font-weight: 700; color: var(--primary); font-size: 1rem; }
        .student-meta { font-size: 0.8rem; color: #666; margin-top: 3px; }
        
        .action-btn { 
            font-size: 0.85rem; 
            cursor: pointer; 
            color: #555; 
            background: #fff; 
            border: 1px solid #ccc; 
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border);
            text-align: right;
            background-color: #fff;
            border-radius: 0 0 8px 8px;
        }

        .btn-close {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        /* --- NOTE MODAL SPECIFIC STYLES --- */
        #noteModal .modal-content {
            width: 550px; 
            max-height: 85vh;
        }

        .note-history-container {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .note-textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        .note-save-btn {
            background-color: var(--success-text);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            margin-left: 10px;
        }

        /* --- MOBILE MEDIA QUERIES --- */
        @media (max-width: 900px) {
            .top-ten-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                padding: 1rem;
            }
            .header-right { text-align: center; }
            .container { padding: 0 1rem; margin: 1rem auto; }
            
            .kpi-card { padding: 1.5rem 1rem; }
            .kpi-value { font-size: 3rem; }
            
            .stats-container { padding: 1rem; }
            .section-header { flex-direction: column; align-items: flex-start; gap: 5px; }
            .section-title { font-size: 1.2rem; }
            
            .top-list { padding: 1rem; }
            
            /* Modal Adjustments for Mobile */
            #dataModal .modal-content, #noteModal .modal-content {
                width: 100%;
                margin: 0;
            }
            .student-row { padding: 10px 15px; }
            .action-btn { padding: 8px 15px; } 
        }

    </style>
</head>
<body>

    <header>
        <div class="brand">
            <h1>American High School</h1>
            <h2>Administration Analytics Dashboard</h2>
        </div>
        <div class="header-right">
            <div class="date-display" id="header-date"></div>
            <div class="refresh-note"></div>
        </div>
    </header>

    <div class="disclaimer-banner">
        ‚ö†Ô∏è DEMO MODE: All student data displayed here is completely fictitious and is for product demonstration purposes only.
    </div>

    <div class="container">
        
        <div class="kpi-section">
            <div class="kpi-card">
                <div class="kpi-title">School-Wide Failure Rate</div>
                <div class="kpi-value" id="kpi-percent">18.4%</div>
                <div class="kpi-sub" id="kpi-context">245 Students Failing 1+ classes</div>
            </div>
        </div>

        <div class="stats-container">
            <div class="section-header"> 
                <h3 class="section-title">Weekly Statistics Summary</h3>
                <div class="legend">
                    <span class="bad"></span> Needs Attention
                    <span class="good"></span> Positive Trend
                </div>
            </div>
            
            <div class="table-responsive">
                <table id="main-stats-table">
                    <thead>
                        <tr>
                            <th style="min-width: 150px;">Statistic</th>
                            <th>Total</th>
                            <th>Group A-G<br></th>
                            <th>Group H-O<br></th>
                            <th>Group P-Z<br></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div style="text-align: center; font-size: 0.8rem; color: #999; margin-top: 5px; display: none;" id="scroll-hint">
                Scroll right to see more ‚Üí
            </div>
        </div>

        <div class="top-ten-grid">
            
            <div class="top-list" id="teachers-container">
                <div class="top-list-header">
                    <h4>Top 10 Teachers (Failing Students)</h4>
                    <div class="list-tabs">
                        <button class="list-tab active" onclick="switchList('teachers', 'volume', this)">By Volume</button>
                        <button class="list-tab" onclick="switchList('teachers', 'rate', this)">By Rate</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="mini-table">
                        <thead id="teachers-thead">
                            </thead>
                        <tbody id="top-teachers-list">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="top-list" id="classes-container">
                <div class="top-list-header">
                    <h4>Top 10 Classes (Failing Students)</h4>
                    <div class="list-tabs">
                        <button class="list-tab active" onclick="switchList('classes', 'volume', this)">By Volume</button>
                        <button class="list-tab" onclick="switchList('classes', 'rate', this)">By Rate</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="mini-table">
                        <thead id="classes-thead">
                            </thead>
                        <tbody id="top-classes-list">
                            </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2025 GC Education Analytics. All Rights Reserved.</p>
            <p>Visit us at <a href="http://gceducationanalytics.com" target="_blank" class="footer-link">gceducationanalytics.com</a> for enterprise solutions.</p>
        </div>
    </footer>

    <div id="dataModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Student List</h3>
                <button class="modal-close" onclick="closeModal('dataModal')">√ó</button>
            </div>
            <div class="modal-subheader">
                <div id="modalStatsLine" class="modal-stats-line"></div>
                <div id="modalDescLine" class="modal-desc-line"></div>
            </div>
            <div class="modal-body" id="modalList">
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeModal('dataModal')">Close</button>
            </div>
        </div>
    </div>

    <div id="noteModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Student Note</h3>
                <button class="modal-close" onclick="closeModal('noteModal')">√ó</button>
            </div>
            <div class="modal-body" style="padding: 15px 20px;">
                <p style="margin-top: 0; margin-bottom: 20px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    Student: <strong id="noteStudentName" style="color: var(--primary); font-size: 1.1em;">Student Name</strong>
                </p>

                <label class="label-text">Previous Admin Notes & Interventions:</label>
                <div id="noteHistory" class="note-history-container">
                </div>

                <label class="label-text">Add New Note:</label>
                <textarea id="noteInput" class="note-textarea" placeholder="Type your note, intervention log, or parent contact details here..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn-close" onclick="closeModal('noteModal')" style="background-color: #6c757d;">Cancel</button>
                <button class="note-save-btn" onclick="saveNote()">Save Note</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. DATA CONFIGURATION ---
        
        const dashboardStats = [
            { key: "TotalStudents", name: "Total Students", desc: "Total active student enrollment for this group.", total: 1330, red: 450, white: 430, gray: 450, type: "neutral", isPercentage: false },
            { key: "TotalFailing", name: "Total Failing", desc: "Students with at least one grade marked 'F'.", total: 245, red: 85, white: 75, gray: 85, type: "bad", isPercentage: false },
            { key: "TotalFailingPct", name: "Total Failing %", desc: "Percentage of total students who are failing.", total: 18.4, red: 18.8, white: 17.4, gray: 18.8, type: "bad", isPercentage: true },
            { key: "AllAs", name: "Current All A's", desc: "Students with a GPA of 4.0 or all 'A's.", total: 412, red: 140, white: 130, gray: 142, type: "good", isPercentage: false },
            { key: "AllAsPct", name: "All A's %", desc: "Percentage of students with all A's.", total: 30.9, red: 31.1, white: 30.2, gray: 31.5, type: "good", isPercentage: true },
            { key: "AllAsBs", name: "Current All A's/B's", desc: "Students with no grades lower than 'B'.", total: 680, red: 230, white: 220, gray: 230, type: "good", isPercentage: false },
            { key: "NewFs", name: "New F's (0 to 1+)", desc: "Students who dropped from passing to failing.", total: 32, red: 12, white: 8, gray: 12, type: "bad", isPercentage: false },
            { key: "ClearedFs", name: "Cleared F's (F to 0)", desc: "Students who cleared all F's.", total: 15, red: 6, white: 4, gray: 5, type: "good", isPercentage: false },
            { key: "IncreasedFs", name: "Increased F's", desc: "Students failing more classes than before.", total: 48, red: 18, white: 14, gray: 16, type: "bad", isPercentage: false },
            { key: "ReducedFs", name: "Reduced F's", desc: "Students failing fewer classes than before.", total: 22, red: 8, white: 6, gray: 8, type: "good", isPercentage: false },
            { key: "GpaTo4", name: "Achieved 4.0 GPA", desc: "Students whose GPA improved to 4.0.", total: 8, red: 3, white: 2, gray: 3, type: "good", isPercentage: false },
            { key: "NewTardies", name: "Increase of 5+ Tardies", desc: "Sudden increase in tardiness.", total: 45, red: 15, white: 10, gray: 20, type: "bad", isPercentage: false },
            { key: "NewGuidances", name: "Increase of 5+ Guidances", desc: "Sudden increase in guidance visits.", total: 12, red: 5, white: 3, gray: 4, type: "bad", isPercentage: false }
        ];

        // --- TOP 10 LISTS DATA ---
        // Teachers Volume: High counts, normal share
        const teachersByVolume = [
            { name: "Mr. Smith", count: 42, stat: "12%" }, // 12% of school total Fs
            { name: "Mrs. Johnson", count: 38, stat: "10%" },
            { name: "Mr. Williams", count: 35, stat: "9.5%" },
            { name: "Ms. Brown", count: 31, stat: "8%" },
            { name: "Mr. Jones", count: 28, stat: "7%" },
            { name: "Mrs. Garcia", count: 25, stat: "6%" },
            { name: "Ms. Miller", count: 22, stat: "5%" },
            { name: "Mr. Davis", count: 20, stat: "4.5%" },
            { name: "Mrs. Rodriguez", count: 18, stat: "4%" },
            { name: "Mr. Martinez", count: 15, stat: "3%" }
        ];

        // Teachers Rate: Lower counts, but high internal failure rates (Red Flags)
        const teachersByRate = [
            { name: "Mr. Strict", count: 8, stat: "53%" }, // 8 failing out of 15 students
            { name: "Ms. NewHire", count: 12, stat: "48%" },
            { name: "Mr. HardGrader", count: 15, stat: "42%" },
            { name: "Mrs. Tough", count: 20, stat: "38%" },
            { name: "Mr. Logic", count: 10, stat: "35%" },
            { name: "Ms. Science", count: 18, stat: "33%" },
            { name: "Mr. Calculus", count: 14, stat: "30%" },
            { name: "Mrs. Chem", count: 22, stat: "28%" },
            { name: "Mr. History", count: 25, stat: "25%" },
            { name: "Ms. English", count: 30, stat: "20%" }
        ];

        // Classes Volume: Aggregates of teachers, so numbers are higher
        const classesByVolume = [
            { name: "Algebra I (All)", count: 115, stat: "15%" },
            { name: "Biology (All)", count: 95, stat: "12%" },
            { name: "World History", count: 88, stat: "11%" },
            { name: "English 9", count: 80, stat: "10%" },
            { name: "Geometry", count: 75, stat: "9%" },
            { name: "Chemistry", count: 60, stat: "7%" },
            { name: "Physical Science", count: 55, stat: "6%" },
            { name: "English 10", count: 50, stat: "5.5%" },
            { name: "US History", count: 45, stat: "5%" },
            { name: "Spanish I", count: 40, stat: "4%" }
        ];

        // Classes Rate: High failure rates relative to enrollment
        const classesByRate = [
            { name: "AP Physics", count: 12, stat: "60%" }, // Hard class, small enrollment
            { name: "Remedial Math", count: 28, stat: "55%" },
            { name: "AP Calculus BC", count: 8, stat: "50%" },
            { name: "Credit Recovery", count: 45, stat: "48%" },
            { name: "Algebra I (Support)", count: 30, stat: "45%" },
            { name: "Organic Chem", count: 10, stat: "40%" },
            { name: "English 9 (Transition)", count: 25, stat: "38%" },
            { name: "Economics", count: 22, stat: "35%" },
            { name: "Adv. Bio", count: 18, stat: "33%" },
            { name: "Geometry", count: 75, stat: "25%" }
        ];

        const topListsData = {
            teachers: {
                volume: teachersByVolume,
                rate: teachersByRate
            },
            classes: {
                volume: classesByVolume,
                rate: classesByRate
            }
        };

        // Dummy Data Generators
        const firstNames = ["James", "Mary", "Robert", "Patricia", "John", "Jennifer", "Michael", "Linda", "David", "Elizabeth", "William", "Barbara", "Richard", "Susan", "Joseph", "Jessica", "Thomas", "Sarah", "Charles", "Karen"];
        const lastNamesRed = ["Adams", "Baker", "Clark", "Davis", "Evans", "Foster", "Garcia", "Green"];
        const lastNamesWhite = ["Harris", "Ingram", "Jackson", "King", "Lewis", "Martin", "Nelson", "Owens"];
        const lastNamesGray = ["Parker", "Quinn", "Roberts", "Smith", "Taylor", "Underwood", "Wilson", "Young", "Zimmerman"];

        // --- 2. INITIALIZATION & RENDERING ---

        function init() {
            // Set Date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('header-date').textContent = new Date().toLocaleDateString('en-US', options);

            // Render Main Stats Table
            renderStatsTable();

            // Render Initial Top Lists (Default: Volume)
            renderTopList('teachers', 'volume');
            renderTopList('classes', 'volume');
            
            // Check for Mobile and show hint
            if(window.innerWidth < 768) {
                document.getElementById('scroll-hint').style.display = 'block';
            }
        }

        function renderStatsTable() {
            const tbody = document.querySelector('#main-stats-table tbody');
            let html = '';

            dashboardStats.forEach(stat => {
                let rowClass = '';
                if (stat.type === 'bad') rowClass = 'row-bad';
                else if (stat.type === 'good') rowClass = 'row-good';

                const createCell = (val, group) => {
                    if (stat.isPercentage) {
                        return `<span class="non-clickable-cell">${val}%</span>`;
                    }
                    if (val === 0) {
                        return `<span class="non-clickable-cell" style="color:#ccc;">0</span>`;
                    }
                    const cleanName = stat.name.replace(/'/g, "\\'");
                    const cleanDesc = stat.desc.replace(/'/g, "\\'");
                    
                    return `<span class="clickable-cell" onclick="openStudentListModal('${cleanName}', '${group}', ${val}, '${stat.key}', '${cleanDesc}')">${val}</span>`;
                };

                html += `
                    <tr class="${rowClass}">
                        <td>${stat.name}</td>
                        <td>${createCell(stat.total, 'Total')}</td>
                        <td>${createCell(stat.red, 'Red Team')}</td>
                        <td>${createCell(stat.white, 'White Team')}</td>
                        <td>${createCell(stat.gray, 'Gray Team')}</td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;
        }

        // Handles the tab switching
        function switchList(category, mode, btnElement) {
            // Update active state of buttons
            const parent = btnElement.parentElement;
            parent.querySelectorAll('.list-tab').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');

            // Re-render the table
            renderTopList(category, mode);
        }

        function renderTopList(category, mode) {
            const tbodyId = category === 'teachers' ? 'top-teachers-list' : 'top-classes-list';
            const theadId = category === 'teachers' ? 'teachers-thead' : 'classes-thead';
            
            const tbody = document.getElementById(tbodyId);
            const thead = document.getElementById(theadId);
            
            const data = topListsData[category][mode];

            // 1. Update Header
            // If mode is volume: "Share of School Fs"
            // If mode is rate: "Internal Failure Rate"
            const statHeaderLabel = mode === 'volume' ? '% of School Fs' : 'Class Failure %';
            
            thead.innerHTML = `
                <tr>
                    <th class="rank-col">#</th>
                    <th>${category === 'teachers' ? 'Teacher' : 'Class'}</th>
                    <th class="val-col">F Count</th>
                    <th class="rate-col">${statHeaderLabel}</th>
                </tr>
            `;

            // 2. Update Body
            let html = '';
            if(!data || data.length === 0) {
                html = '<tr><td colspan="4">No data available.</td></tr>';
            } else {
                data.forEach((item, index) => {
                    html += `
                        <tr>
                            <td class="rank-col">${index + 1}</td>
                            <td>${item.name}</td>
                            <td class="val-col">${item.count}</td>
                            <td class="rate-col">${item.stat}</td>
                        </tr>
                    `;
                });
            }
            tbody.innerHTML = html;
        }

        // --- 3. MODAL LOGIC (DATA GENERATION) ---

        function openStudentListModal(metricName, groupName, count, metricKey, description) {
            const modal = document.getElementById('dataModal');
            document.getElementById('modalTitle').textContent = metricName;
            
            const statsLine = document.getElementById('modalStatsLine');
            const descLine = document.getElementById('modalDescLine');
            
            statsLine.innerHTML = `Group: <strong style="color:var(--primary)">${groupName}</strong> &nbsp;|&nbsp; Count: <strong>${count}</strong>`;
            descLine.textContent = description; 
            
            const listContainer = document.getElementById('modalList');
            listContainer.innerHTML = ''; 

            let studentsHTML = '';
            for (let i = 0; i < count; i++) {
                studentsHTML += generateStudentRow(groupName, metricKey);
            }
            listContainer.innerHTML = studentsHTML;

            modal.style.display = 'flex';
        }

        function generateStudentRow(group, metricKey) {
            const fname = firstNames[Math.floor(Math.random() * firstNames.length)];
            let lname = '';
            
            if (group === 'Red Team') lname = lastNamesRed[Math.floor(Math.random() * lastNamesRed.length)];
            else if (group === 'White Team') lname = lastNamesWhite[Math.floor(Math.random() * lastNamesWhite.length)];
            else if (group === 'Gray Team') lname = lastNamesGray[Math.floor(Math.random() * lastNamesGray.length)];
            else {
                const allNames = [...lastNamesRed, ...lastNamesWhite, ...lastNamesGray];
                lname = allNames[Math.floor(Math.random() * allNames.length)];
            }

            const id = Math.floor(10000 + Math.random() * 90000);
            const studentName = `${lname}, ${fname}`;
            const safeStudentName = studentName.replace(/'/g, "\\'");

            return `
                <div class="student-row">
                    <div class="student-info">
                        <span class="student-name">${studentName}</span>
                        <span class="student-meta">ID: ${id}</span>
                    </div>
                    <button class="action-btn" title="Add Note" onclick="openNoteModal('${safeStudentName}')">üìù Note</button>
                </div>
            `;
        }

        // --- 4. NOTE MODAL LOGIC ---

        let currentNoteStudent = ""; 

        function openNoteModal(studentName) {
            currentNoteStudent = studentName;
            document.getElementById('noteStudentName').textContent = studentName;
            document.getElementById('noteInput').value = ""; 
            
            const historyDiv = document.getElementById('noteHistory');
            const hasHistory = Math.random() > 0.3; 
            
            if (hasHistory) {
                const d = new Date();
                d.setDate(d.getDate() - Math.floor(Math.random() * 10));
                const dateStr = d.toLocaleDateString();

                const notes = [
                    "Called parent regarding missing assignments.",
                    "Met with guidance counselor.",
                    "Student is attending tutoring during study hall.",
                    "Discipline referral processed.",
                    "Grade check completed."
                ];
                const admins = ["Principal Jones", "AP Smith", "Counselor Doe", "Admin Assistant"];
                
                const randomNote = notes[Math.floor(Math.random() * notes.length)];
                const randomAdmin = admins[Math.floor(Math.random() * admins.length)];

                historyDiv.innerHTML = `
                    <div class="note-entry">
                        <div class="note-meta">${dateStr} - ${randomAdmin}</div>
                        <div class="note-text">${randomNote}</div>
                    </div>
                `;
            } else {
                historyDiv.innerHTML = `<div style="color:#999; font-style:italic; font-size:0.9em;">No previous notes found.</div>`;
            }

            document.getElementById('noteModal').style.display = 'flex';
            document.getElementById('noteInput').focus();
        }

        function saveNote() {
            const text = document.getElementById('noteInput').value.trim();
            if (text === "") {
                alert("Please write a note before saving.");
                return;
            }
            
            alert(`Note saved for ${currentNoteStudent}:\n\n"${text}"\n\n(This is a demo. In the full product, this saves to the database.)`);
            closeModal('noteModal');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = "none";
            }
        }

        // Start App
        init();

    </script>
</body>
</html>
